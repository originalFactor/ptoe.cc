---
title: '[C++] 乘方'
date: 2025-06-22 20:14:37
categories: 编程
mathjax: true
---

[P8813 \[CSP-J 2022\] 乘方 - 洛谷](https://www.luogu.com.cn/problem/P8813)

小文同学刚刚接触了信息学竞赛，有一天她遇到了这样一个题：给定正整数 $a$ 和 $b$，求 $a^b$ 的值是多少。

$a^b$ 即 $b$ 个 $a$ 相乘的值，例如 $2^3$ 即为 $3$ 个 $2$ 相乘，结果为 $2 \times 2 \times 2 = 8$。

“简单！”小文心想，同时很快就写出了一份程序，可是测试时却出现了错误。

小文很快意识到，她的程序里的变量都是 `int` 类型的。在大多数机器上，`int` 类型能表示的最大数为 $2^{31} - 1$，因此只要计算结果超过这个数，她的程序就会出现错误。

由于小文刚刚学会编程，她担心使用 `int` 计算会出现问题。因此她希望你在 $a^b$ 的值超过 ${10}^9$ 时，输出一个 `-1` 进行警示，否则就输出正确的 $a^b$ 的值。

然而小文还是不知道怎么实现这份程序，因此她想请你帮忙。

<!--More-->

## 输入格式

输入共一行，两个正整数 $a, b$。

## 输出格式

输出共一行，如果 $a^b$ 的值不超过 ${10}^9$，则输出 $a^b$ 的值，否则输出 `-1`。

## 输入输出样例 #1

### 输入 #1

```
10 9
```

### 输出 #1

```
1000000000
```

## 输入输出样例 #2

### 输入 #2

```
23333 66666
```

### 输出 #2

```
-1
```

## 说明/提示

对于 $10 \%$ 的数据，保证 $b = 1$。  
对于 $30 \%$ 的数据，保证 $b \le 2$。  
对于 $60 \%$ 的数据，保证 $b \le 30$，$a^b \le {10}^{18}$。  
对于 $100 \%$ 的数据，保证 $1 \le a, b \le {10}^9$。

$\text{upd 2022.11.14/2025.04.02}$：各新增加一组 $\text{Hack}$ 数据。

## 题解

非常简单的快速幂，但是要注意溢出，非常恶心，所以我直接`log2`计算占用位数，若计算后占用超过 $10^9$ 需要的二进制位就返回`-1`

```cpp
#include <bits/stdc++.h>
using namespace std;

int qpow(int a, unsigned int b){
	if(!b) return 1;
	int c = qpow(a, b/2);
	if(c==-1 || log2(c)*2>log2(1e9)) return -1;
	int d = c*c*(b&1?a:1);
	if(d>(int)1e9) return -1;
	return d;
}

int main(){
	int a, b;
	cin >> a >> b;
	cout << qpow(a,b);
	return 0;
}
```

